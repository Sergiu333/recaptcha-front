<!-- <!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test reCAPTCHA v2</title>
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
</head>
<body>
<h1>Test reCAPTCHA v2</h1>

<form id="captcha-form" action="#" method="POST">
    <!-- Widgetul reCAPTCHA cu checkbox -->
    <div class="g-recaptcha" data-sitekey="6Lf2IDErAAAAAFpdiKe1LmFuvGWpTfMnyxKn2pXm"></div>
    <button type="submit">Trimite1</button>
</form>

<script>
    const form = document.getElementById('captcha-form');

    form.addEventListener('submit', async (e) => {
        e.preventDefault();

        const token = grecaptcha.getResponse();  // Obține tokenul reCAPTCHA

        if (!token) {
            alert('Te rog completeaza captcha!');
            return;
        }

        try {
            const response = await fetch('https://recaptcha-back.vercel.app/verify', {  // Asigură-te că adresa serverului este corectă
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ 'g-recaptcha-response': token })
            });

            const data = await response.json();
            console.log(data);
            alert(data.message);
        } catch (error) {
            console.error('Eroare:', error);
            alert('Eroare la trimitere!');
        }
    });
</script>
</body>
</html>
 -->

<!-- 

 <!DOCTYPE html>
<html>
<head>
  <title>Test reCAPTCHA v3</title>
  <script src="https://www.google.com/recaptcha/api.js?render=6Lddu0orAAAAAJX_tGcRWQFMkIhPXfo8ShMGvqgT"></script>
  <script>
    function runCaptcha() {
      grecaptcha.ready(function () {
        grecaptcha.execute('6Lddu0orAAAAAJX_tGcRWQFMkIhPXfo8ShMGvqgT', { action: 'submit' }).then(function (token) {
          // Trimite tokenul către backend
          fetch('https://recaptcha-back-v3.vercel.app/verify', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ token })
          })
            .then(response => response.json())
            .then(data => {
              console.log('Răspuns server:', data);
              alert(`reCAPTCHA success: ${data.success}, scor: ${data.score}`);
            })
            .catch(error => {
              console.error('Eroare:', error);
              alert('A apărut o eroare.');
            });
        });
      });
    }
  </script>
</head>
<body>
  <h1>Test Google reCAPTCHA v3</h1>
  <button onclick="runCaptcha()">Verifică</button>
</body>
</html>

-->





<!--Pragma: no-cache-->
<!--Cache-Control: no-store-->
<!--Content-type: text/html; charset=UTF-8-->
<!--Strict-Transport-Security: max-age=31536000; includeSubDomains-->

<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <meta name="GENERATOR" content="Mozilla/4.72 [en] (WinNT; U) [Netscape]">
    <script async src="https://pay.google.com/gp/p/js/pay.js" onload="onGooglePayLoaded()"></script>
    <title>Victoriabank</title>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="/cardop/images/1recaptcha/css/tranform.css">
    <link rel="stylesheet" href="/cardop/images/1recaptcha/css/nascut_in_md.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">

    <script src="/cardop/images/1recaptcha/js/tranform.js"></script>
    <script src="/cardop/images/1recaptcha/js/GPay.js" async></script>
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
    <script src="https://www.google.com/recaptcha/api.js?render=6Lddu0orAAAAAJX_tGcRWQFMkIhPXfo8ShMGvqgT"></script>

    <script>
        /**
         * Define the version of the Google Pay API referenced when creating your
         * configuration
         *
         * @see {@link https://developers.google.com/pay/api/web/reference/request-objects#PaymentDataRequest|apiVersion in PaymentDataRequest}
         *
         * Add container html tag
         *  <div id="gpay_container"></div>
         *
         */
        const baseRequest = {
            apiVersion: 2,
            apiVersionMinor: 0
        };

        /**
         * Card networks supported by your site and your gateway
         *
         * @see {@link https://developers.google.com/pay/api/web/reference/request-objects#CardParameters|CardParameters}
         * @todo confirm card networks supported by your site and gateway
         */
        const allowedCardNetworks = ["AMEX", "DISCOVER", "INTERAC", "JCB", "MASTERCARD", "MIR", "VISA"];

        /**
         * Card authentication methods supported by your site and your gateway
         *
         * @see {@link https://developers.google.com/pay/api/web/reference/request-objects#CardParameters|CardParameters}
         * @todo confirm your processor supports Android device tokens for your
         * supported card networks
         */
        const allowedCardAuthMethods = ["PAN_ONLY", "CRYPTOGRAM_3DS"];

        /**
         * Identify your gateway and your site's gateway merchant identifier
         *
         * The Google Pay API response will return an encrypted payment method capable
         * of being charged by a supported gateway after payer authorization
         *
         * @todo check with your gateway on the parameters to pass
         * @see {@link https://developers.google.com/pay/api/web/reference/request-objects#gateway|PaymentMethodTokenizationSpecification}
         */
        const tokenizationSpecification = {
            type: 'PAYMENT_GATEWAY',
            parameters: {
                'gateway': 'victoriabank',
                'gatewayMerchantId': 'googletest'
            }
        };

        /**
         * Describe your site's support for the CARD payment method and its required
         * fields
         *
         * @see {@link https://developers.google.com/pay/api/web/reference/request-objects#CardParameters|CardParameters}
         */
        const baseCardPaymentMethod = {
            type: 'CARD',
            parameters: {
                allowedAuthMethods: allowedCardAuthMethods,
                allowedCardNetworks: allowedCardNetworks
            }
        };

        /**
         * Describe your site's support for the CARD payment method including optional
         * fields
         *
         * @see {@link https://developers.google.com/pay/api/web/reference/request-objects#CardParameters|CardParameters}
         */
        const cardPaymentMethod = Object.assign(
            {},
            baseCardPaymentMethod,
            {
                tokenizationSpecification: tokenizationSpecification
            }
        );

        /**
         * An initialized google.payments.api.PaymentsClient object or null if not yet set
         *
         * @see {@link getGooglePaymentsClient}
         */
        let paymentsClient = null;

        /**
         * Configure your site's support for payment methods supported by the Google Pay
         * API.
         *
         * Each member of allowedPaymentMethods should contain only the required fields,
         * allowing reuse of this base request when determining a viewer's ability
         * to pay and later requesting a supported payment method
         *
         * @returns {object} Google Pay API version, payment methods supported by the site
         */
        function getGoogleIsReadyToPayRequest() {
            return Object.assign(
                {},
                baseRequest,
                {
                    allowedPaymentMethods: [baseCardPaymentMethod]
                }
            );
        }

        /**
         * Configure support for the Google Pay API
         *
         * @see {@link https://developers.google.com/pay/api/web/reference/request-objects#PaymentDataRequest|PaymentDataRequest}
         * @returns {object} PaymentDataRequest fields
         */
        function getGooglePaymentDataRequest() {
            const paymentDataRequest = Object.assign({}, baseRequest);
            paymentDataRequest.allowedPaymentMethods = [cardPaymentMethod];
            paymentDataRequest.transactionInfo = getGoogleTransactionInfo();
            paymentDataRequest.merchantInfo = {
                // @todo a merchant ID is available for a production environment after approval by Google
                // See {@link https://developers.google.com/pay/api/web/guides/test-and-deploy/integration-checklist|Integration checklist}
                merchantId: 'BCR2DN4TXWQ7JUBH',
                merchantName: 'Victoriabank'
            };
            return paymentDataRequest;
        }

        /**
         * Return an active PaymentsClient or initialize
         *
         * @see {@link https://developers.google.com/pay/api/web/reference/client#PaymentsClient|PaymentsClient constructor}
         * @returns {google.payments.api.PaymentsClient} Google Pay API client
         */
        function getGooglePaymentsClient() {
            if ( paymentsClient === null ) {
                paymentsClient = new google.payments.api.PaymentsClient({environment: 'PRODUCTION'});
            }
            return paymentsClient;
        }

        /**
         * Initialize Google PaymentsClient after Google-hosted JavaScript has loaded
         *
         * Display a Google Pay payment button after confirmation of the viewer's
         * ability to pay.
         */
        function onGooglePayLoaded() {
            const paymentsClient = getGooglePaymentsClient();
            paymentsClient.isReadyToPay(getGoogleIsReadyToPayRequest())
                .then(function(response) {
                    if (response.result) {
                        addGooglePayButton();
                        // @todo prefetch payment data to improve performance after confirming site functionality
                        // prefetchGooglePaymentData();
                    }
                })
                .catch(function(err) {
                    // show error in developer console for debugging
                    console.error(err);
                });
        }

        onGooglePayLoaded()
        /**
         * Add a Google Pay purchase button alongside an existing checkout button
         *
         * @see {@link https://developers.google.com/pay/api/web/reference/request-objects#ButtonOptions|Button options}
         * @see {@link https://developers.google.com/pay/api/web/guides/brand-guidelines|Google Pay brand guidelines}
         */
        function addGooglePayButton() {
            const paymentsClient = getGooglePaymentsClient();
            const button =
                paymentsClient.createButton({
                    onClick: onGooglePaymentButtonClicked,
                    allowedPaymentMethods: [baseCardPaymentMethod]
                });
            document.getElementById('gpay_container').appendChild(button);
        }

        /**
         * Provide Google Pay API with a payment amount, currency, and amount status
         *
         * @see {@link https://developers.google.com/pay/api/web/reference/request-objects#TransactionInfo|TransactionInfo}
         * @returns {object} transaction info, suitable for use as transactionInfo property of PaymentDataRequest
         */
        function getGoogleTransactionInfo() {
            return {
                // countryCode: 'US',
                currencyCode: '%26',
                totalPriceStatus: 'FINAL',
                // set to cart total
                totalPrice: '%25'
            };
        }

        /**
         * Prefetch payment data to improve performance
         *
         * @see {@link https://developers.google.com/pay/api/web/reference/client#prefetchPaymentData|prefetchPaymentData()}
         */
        function prefetchGooglePaymentData() {
            const paymentDataRequest = getGooglePaymentDataRequest();
            // transactionInfo must be set but does not affect cache
            paymentDataRequest.transactionInfo = {
                totalPriceStatus: 'NOT_CURRENTLY_KNOWN',
                currencyCode: '%26'
            };
            const paymentsClient = getGooglePaymentsClient();
            paymentsClient.prefetchPaymentData(paymentDataRequest);
        }

        /**
         * Show Google Pay payment sheet when Google Pay payment button is clicked
         */
        function onGooglePaymentButtonClicked() {
            const paymentDataRequest = getGooglePaymentDataRequest();
            paymentDataRequest.transactionInfo = getGoogleTransactionInfo();

            const paymentsClient = getGooglePaymentsClient();
            paymentsClient.loadPaymentData(paymentDataRequest)
                .then(function(paymentData) {
                    // handle the response
                    processPayment(paymentData);
                })
                .catch(function(err) {
                    // show error in developer console for debugging
                    console.error(err);
                });
        }
        /**
         * Process payment data returned by the Google Pay API
         *
         * @param {object} paymentData response from Google Pay API after user approves payment
         * @see {@link https://developers.google.com/pay/api/web/reference/response-objects#PaymentData|PaymentData object reference}
         */
        function processPayment(paymentData) {
            // show returned data in developer console for debugging
            console.log(paymentData);
            // @todo pass payment token to your gateway to process payment
            paymentToken = paymentData.paymentMethodData.tokenizationData.token;
            if( !empty(paymentToken) ) {
                addValue("tform", "GPAYTOKEN", paymentToken);
                document.getElementById("tform").submit();
            }

        }

        function addValue(fid, n,v) {
            var el = document.createElement('input');
            el.setAttribute('type', 'hidden');
            el.setAttribute('name', n);
            el.setAttribute('value', v);
            document.getElementById(fid).appendChild( el );
        }

        function empty(str) {
            if (typeof str == 'undefined' || !str || str.length === 0 || str === "" || !/[^\s]/.test(str) || /^\s*$/.test(str) || str.replace(/\s/g,"") === "")
                return true;
            else
                return false;
        }

        function getApplePaySession(url) {
            return new Promise(function (resolve, reject) {
                var xhr = new XMLHttpRequest();
                xhr.open('POST', '/cgi-bin/cgi_link');
                xhr.onload = function () {
                    if (this.status >= 200 && this.status < 300) {
                        resolve(JSON.parse(xhr.response));
                    } else {
                        reject({
                            status: this.status,
                            statusText: xhr.statusText
                        });
                    }
                };
                xhr.onerror = function () {
                    reject({
                        status: this.status,
                        statusText: xhr.statusText
                    });
                };
                xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                xhr.send('TERMINAL=%21&TRTYPE=183&MOBILE_WALLET_SESSION_URL=' + url);
            });
        }

        // Example function with async post to E-Gateway
        function sendApplePayToken(session) {
            return new Promise(function (resolve, reject) {
                var xhr = new XMLHttpRequest();
                xhr.open('POST', '/cgi-bin/cgi_link');
                xhr.onload = function () {
                    session.completePayment(ApplePaySession.STATUS_SUCCESS);
                };
                xhr.onerror = function () {
                    session.completePayment(ApplePaySession.STATUS_FAILURE);
                };
                xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                var formData = new FormData( document.getElementById("tform") );

                if (formData.get('CVC2_RC')) {
                    formData.set('CVC2_RC', '2');
                }

                var urlFormData = new URLSearchParams(formData)
                xhr.send(urlFormData);
            });
        }

        /**
         * Apple Pay Logic
         * Our entry point for Apple Pay interactions.
         * Triggered when the Apple Pay button is pressed
         */
        function applePayButtonClicked() {
            console.log("apple pay button clicked");
            const paymentRequest = {
                countryCode: 'US',
                currencyCode: '%26',
                // shippingMethods: [
                //     {
                //         label: 'Free Shipping',
                //         amount: '0.00',
                //         identifier: 'free',
                //         detail: 'Delivers in five business days',
                //     },
                //     {
                //         label: 'Express Shipping',
                //         amount: '5.00',
                //         identifier: 'express',
                //         detail: 'Delivers in two business days',
                //     },
                // ],

                //   lineItems: [
                //       {
                //           label: 'This is a line item label',
                //           amount: '0.00',
                //       }
                //   ],

                total: {
                    label: 'This is the total label',
                    amount: '%25',
                },

                supportedNetworks:[ 'amex', 'discover', 'masterCard', 'visa'],
                merchantCapabilities: [ 'supports3DS' ],

            };

            const session = new ApplePaySession(1, paymentRequest);
            console.log("session object created")

            session.oncancel = (event) => {
                console.log("oncancel");
                console.log(event);
            };

            /**
             * Merchant Validation
             * We call our merchant session endpoint, passing the URL to use
             */
            session.onvalidatemerchant = (event) => {
                const validationURL = event.validationURL;
                console.log("validate merchant");
                console.log("validation url=" + validationURL);
                getApplePaySession(validationURL).then(function(response) {
                    console.log(response);
                    session.completeMerchantValidation(response);
                });
            };

            /**
             * Shipping Method Selection
             * If the user changes their chosen shipping method we need to recalculate
             * the total price. We can use the shipping method identifier to determine
             * which method was selected.
             */
            session.onshippingmethodselected = (event) => {
                console.log("onshippingmethodselected");
                // const shippingCost = event.shippingMethod.identifier === 'free' ? '0.00' : '5.00';
                // const totalCost = event.shippingMethod.identifier === 'free' ? '8.99' : '13.99';
                //
                // const lineItems = [
                //     {
                //         label: 'Shipping',
                //         amount: shippingCost,
                //     },
                // ];
                //
                // const total = {
                //     label: 'Apple Pay Example',
                //     amount: totalCost,
                // };
                //
                // session.completeShippingMethodSelection(ApplePaySession.STATUS_SUCCESS, total, lineItems);
            };

            /**
             * Payment Authorization
             * Here you receive the encrypted payment data. You would then send it
             * on to your payment provider for processing, and return an appropriate
             * status in session.completePayment()
             */
            session.onpaymentauthorized = (event) => {
                // Send payment for processing...
                const payment = event.payment;
                addValue("tform", "APPLE_PAY_TOKEN", btoa(JSON.stringify(payment.token)));

                var tform = document.getElementById("tform");
                if(tform) {
                    if (tform.CVC2_RC) {
                        tform.CVC2_RC.value = 2;
                    }
                    document.getElementById("tform").submit();
                }
            };

            // All our handlers are setup - start the Apple Pay payment
            console.log("start Apple Pay payment");
            session.begin();
        }
    </script>
</head>
<body onload="document.getElementById('pay').disabled=true;">
<header class="header">
    <div class="header-inner">
        <a href="https://www.victoriabank.md/" target="_blank">
            <img src="/cardop/images/1recaptcha/img/logo.png" alt="Logo VB" id="logoVB">
        </a>
    </div>
</header>


<form id="tform" action="/cgi-bin/cgi_link" method="POST" autocomplete="off"
      onsubmit="updateExpFields(); SEND_BUTTON.disabled=true; return true;">


    <div class="container_desc">
        <div class="title_form">Payment details</div>
        <div class="description_form">Select the payment method and enter the card details.</div>
    </div>
    <div class="container_payment">
        <div class="left_block">
<!--                        <div align=left id="gpay_container"></div>-->
<!--                        <div class="or-container">-->
<!--                            <div class="line_gray"></div>-->
<!--                            <div class="or">or pay with card</div>-->
<!--                        </div>-->
<!--            <div class="desktop-banner">-->
<!--                <img src="/cardop/images/1recaptcha/img/mdBlockDesk_en.png"-->
<!--                     alt="Achit? biletul pe afisha.md cu cardul Salut ?i ai 10% reducere la biletele pentru festivalul N?scut în Moldova!">-->
<!--            </div>-->
<!--            <div class="mobile-banner">-->
<!--                <img src="cardop/images/1recaptcha/img/mdBlockMobile_en.png"-->
<!--                     alt="Achita biletul pe afisha.md cu cardul Salut si ai 10% reducere la biletele pentru festivalul Nascut în Moldova!">-->
<!--            </div>-->
            <div class="container_inputs" style="padding-top: 20px">
                <div>
                    <div class="label">Card number</div>
                    <input type="text" name="CARD" id="creditcard" size="19" maxlength="19"
                           inputmode="numeric" pattern="[0-9]*" autocomplete="cc-number"
                           data-minlength="16" placeholder="**** **** **** ****"
                           onkeypress="javascript: checkDigit(event);"
                           oninput="javascript: cardMask('0000 0000 0000 0000', event); CheckFilledData();">
                    <div class="error_input" id="card_error_message">Invalid card number</div>
                </div>


                <div class="container_expiry_and_cvv">
                    <div>
                        <div class="label">Valid thru</div>
                        <input type="text" id="exp-date" placeholder="MM / YY" maxlength="9"
                               oninput="formatExpDate(); CheckFilledData();">
                    </div>
                    <div>
                        <div class="label">CVV</div>
                        <input type="text" placeholder="***" name="CVC2"
                               inputmode="numeric" pattern="[0-9]*" autocomplete="cc-csc"
                               id='cvv'
                               size="3" maxlength="3" onkeypress="return checkDigit(event);"
                               oninput="cardMask('000', event); CheckFilledData()">
                    </div>
                </div>

            </div>
            <div class="recaptcha">
                <div class="recaptcha-wrapper">
                    <div class="g-recaptcha"
                         data-sitekey="6Lf2IDErAAAAAFpdiKe1LmFuvGWpTfMnyxKn2pXm">
                    </div>
                </div>
            </div>
            <input type="submit" id="pay" class="btn btn_approve" value="Approve" name="SEND_BUTTON" onclick="CCNumberFormat(); console.log('click!')">
        </div>

        <div class="block_details" id="orderDetails">
            <div class="dropdown-header">
                <div>
                    <div class="title_filed">Order amount: </div>
                    <div class="amount">%25</div>
                </div>
                <div class="dropdown-arrow">
                    <img src="/cardop/images/1recaptcha/img/down-arrow-svgrepo-com.svg" alt="" width="25px" height="15px">
                </div>
            </div>

            <div class="dropdown-content">
                <input TYPE="HIDDEN" NAME="AMOUNT" VALUE="%25">
                <div class="title_filed">Order currency: </div>
                <div class="description_field">%26</div>
                <input TYPE="HIDDEN" NAME="CURRENCY" VALUE="%26">
                <div class="title_filed">Order description: </div>
                <div class="description_field">%58</div>
                <input TYPE="HIDDEN" NAME="DESC" VALUE="%58">
                <div class="title_filed">Merchant name: </div>
                <div class="description_field">%53</div>
                <input TYPE="HIDDEN" NAME="MERCH_NAME" VALUE="%53">
                <div class="title_filed">Merchant's URL: </div>
                <div class="description_field">%55</div>
                <input TYPE="HIDDEN" NAME="MERCH_URL" VALUE="%55">
                <div class="title_filed">Merchant address: </div>
                <div class="description_field">%71</div>
                <input TYPE="HIDDEN" NAME="MERCH_ADDRESS" VALUE="%71">
            </div>
        </div>
    </div>

    <div class="icons">
        <div class="size-icons-logo-trustwave">
            <script type="text/javascript"
                    src="https://sealserver.trustwave.com/seal.js?style=invert"></script>
        </div>
        <a href="http://www.visaeurope.com/en/cardholders/verified_by_visa.aspx" target="_blank">
            <img class="size-icons-logo-visa" src="/cardop/images/1recaptcha/img/visa-secure-logo.png"
                 alt="visa logo">
        </a>
        <a href="http://www.mastercard.us/securecode.html" target="_blank">
            <img class="size-icons-logo-master" src="/cardop/images/1recaptcha/img/MasterCard_Logo2.png"
                 alt="master logo">
        </a>
    </div>
    <input type="hidden" name="EXP" id="exp-month">
    <input type="hidden" name="EXP_YEAR" id="exp-year">
    <input TYPE="HIDDEN" NAME="ORDER" VALUE="%27"></input>
    <input TYPE="HIDDEN" NAME="TERMINAL" VALUE="%21"></input>
    <input TYPE="HIDDEN" NAME="MERCHANT" VALUE="%29"></input>
    <input TYPE="HIDDEN" NAME="TRTYPE" VALUE="%22"></input>
    <input TYPE="HIDDEN" NAME="COUNTRY" VALUE="%54"></input>
    <input TYPE="HIDDEN" NAME="MERCH_GMT" VALUE="%56"></input>
    <input TYPE="HIDDEN" NAME="TIMESTAMP" VALUE="%47"></input>
    <input TYPE="HIDDEN" NAME="NONCE" VALUE="%61"></input>
    <input TYPE="HIDDEN" NAME="BACKREF" VALUE="%41"></input>
    <input TYPE="HIDDEN" NAME="P_SIGN" VALUE="%44"></input>
    <input TYPE="HIDDEN" NAME="FORM_ID" VALUE="%65"></input>
    <input type="HIDDEN" NAME="M_INFO" VALUE="%389"></input>
</form>


</body>
</html>

<script>
    document.querySelector('.dropdown-header').addEventListener('click', function() {
        document.getElementById('orderDetails').classList.toggle('open');
    });
</script>


<script>
    const form = document.getElementById('tform');

    form.addEventListener('submit', async (e) => {
        e.preventDefault();

        // Execută reCAPTCHA cu acțiunea "submit"
        grecaptcha.ready(() => {
            grecaptcha.execute('6Lddu0orAAAAAJX_tGcRWQFMkIhPXfo8ShMGvqgT', { action: 'submit' }).then(async (token) => {
                try {
                    const response = await fetch('https://recaptcha-back-v3.vercel.app/verify', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            token,
                            action: 'submit'
                        })
                    });

                    const data = await response.json();

                    if (data.success) {
                        form.submit(); // trimite formularul doar dacă token-ul e valid
                    } else {
                        alert(data.message || 'Captcha invalid sau suspicios!');
                    }
                } catch (error) {
                    console.error('Eroare:', error);
                    alert('Eroare la validare reCAPTCHA!');
                }
            });
        });
    });


    document.addEventListener("DOMContentLoaded", function () {
        const input = document.getElementById("creditcard");

        cardMask("0000 0000 0000 0000", { currentTarget: input });

        input.addEventListener("input", (e) => cardMask("0000 0000 0000 0000", e));
        input.addEventListener("focus", (e) => cardMask("0000 0000 0000 0000", e));

        const observer = new MutationObserver(() => {
            cardMask("0000 0000 0000 0000", { currentTarget: input });
        });
        observer.observe(input, {
            attributes: true,
            attributeFilter: ["value"],
        });

        document.getElementById("tform").addEventListener("submit", function (e) {
            let rawValue = input.value.replace(/\s+/g, '');

            let existingHidden = document.getElementById("creditcard_raw");
            if (!existingHidden) {
                existingHidden = document.createElement("input");
                existingHidden.type = "hidden";
                existingHidden.name = input.name;
                existingHidden.id = "creditcard_raw";
                input.form.appendChild(existingHidden);
            }

            existingHidden.value = rawValue;

            input.removeAttribute("name");

            setTimeout(() => {
                cardMask("0000 0000 0000 0000", { currentTarget: input });
                const payButton = document.getElementById('pay');
                if (payButton) payButton.disabled = false;
            }, 300);
        });
    });

</script>

